title: Добавить set_support_topic_id в IUserRepo
status: done
created_at: 15.02.2026
completed_at: 15.02.2026

todoist:
  task_id: "6g2g8h3fXPV3X7hm"

description: |
  SupportTopicManager вызывает user_repo.update(user), который обновляет все поля User.
  Нужен точечный метод для обновления только support_topic_id.
  Race condition между get_by_id и update.

recommendation: |
  Добавить метод set_support_topic_id(user_id, topic_id) в IUserRepo и UserRepo.
  Использовать его в SupportTopicManager вместо update(user).

solution: |
  Добавлен метод set_support_topic_id(user_id, topic_id) в протокол IUserRepo и реализацию UserRepo. Метод выполняет точечное UPDATE только поля support_topic_id, избегая race condition. SupportTopicManager теперь использует set_support_topic_id вместо update(user).
